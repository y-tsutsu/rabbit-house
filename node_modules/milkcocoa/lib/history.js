function History(t,i){this.stream=new Stream2(t,i),this._times=1,this._limit=null,this._span=null,this.listeners={}}var Stream2=require("./streaming2");History.prototype.sort=function(t){return this.stream.sort(t),this},History.prototype.size=function(t){return this.stream.size(t),this},History.prototype.times=function(t){return this._times=t,this},History.prototype.limit=function(t){return this._limit=t,this},History.prototype.span=function(t,i){return this._span={start:t,end:i},this},History.prototype.on=function(t,i){return this.listeners[t]=i,this},History.prototype.run=function(){this._span?"DESC"==this.stream.stream._sort?(this.stream.setTimestamp(this._span.end),this.runSpan(this._span.start.toString(36))):(this.stream.setTimestamp(this._span.start),this.runSpan(this._span.end.toString(36))):this._limit?this.runLimit(this._limit):this.runTimes(this._times)},History.prototype.runTimes=function(t){var i=this;this.stream.next(function(r,s){return r?void i.fire("error",r):(t--,i.fire("data",s),void(t>0?i.runTimes(t):i.fire("end")))})},History.prototype.runLimit=function(t){var i=this;this.stream.next(function(r,s){return r?void i.fire("error",r):(t-=s.length,0>t?"DESC"==i.stream.stream._sort?i.fire("data",s.slice(0,s.length+t)):i.fire("data",s.slice(0,s.length+t)):s.length>0&&i.fire("data",s),void(t>0&&s.length>0?i.runLimit(t):i.fire("end")))})},History.prototype.runSpan=function(t){var i=this;this.stream.next(function(r,s){if(r)return void i.fire("error",r);if("DESC"==i.stream.stream._sort)var e=function(i){return i.id>=t};else var e=function(i){return i.id<=t};var n=s.filter(e);n.length>0?(i.fire("data",n),i.runSpan(t)):i.fire("end")})},History.prototype.fire=function(t,i){this.listeners[t]&&this.listeners[t](i)},module.exports=History;